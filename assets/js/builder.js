hljs.initHighlightingOnLoad(),$(function(){function e(e){var a=$(this),t=a.data("field");M[t].selectMultipleData.primaryKeyAliasToThisTable=a.val()}function a(e){var a=$(this),t=a.data("field");M[t].selectMultipleData.primaryKeyAliasToSelectionTable=a.val()}function t(e){var a=$(this),t=a.data("field");M[t].selectMultipleData.titleFieldSelectionTable=a.val()}function i(e){var a=$(this),t=a.data("field");M[t].selectMultipleData.labelName=a.val()}function n(e){var a=$(this),t=a.data("field");M[t].selectData.fieldReff=a.val()}function l(e){var a=$(this),t=a.data("field");M[t].selectData.labelReff=a.val()}function o(e){var a=$(this),t=a.data("field");M[t].selectData.table=a.val()}function d(e){var a=$(this).val(),t=$(this).data("field");M[t].alias=a}function c(e){var a=e.data.val,t=$(this);M[t.data("field")].actions[t.data("action")]=a,T()}function r(e){var a={},t=!1,i=$(this),n=i.data("name"),l=i.data("field");""!=i.val()&&(a[n]=i.val(),M[l].validation.forEach(function(e,i){"undefined"!=typeof e[n]&&(t=!0,M[l].validation[i]=a)}),t===!1&&M[l].validation.push(a))}function s(){var e=$(".fieldsNames");""!=$("#field-table_config").text()?M=JSON.parse($("#field-table_config").text()):e.each(f)}function f(){var e,a,t,i,n,l,o=$(this),d=o.val();a=$("input[name='table["+d+"][column]']:checked").val(),t=$("input[name='table["+d+"][add]']:checked").val(),i=$("input[name='table["+d+"][edit]']:checked").val(),n=$("input[name='table["+d+"][details]']:checked").val(),l=$("select[name='table["+d+"][type]']").val(),a=u(a),t=u(t),i=u(i),n=u(n),e={actions:{column:a,add:t,edit:i,details:n},type:l,selectData:{},selectMultipleData:{},validation:[]},M[d]=e}function u(e){return void 0===e?0:e}function h(){var e=$(".form-breadcrumb:last").clone();e.children().children().val(""),e.insertAfter(".form-breadcrumb:last"),$(".remove-crumb").click(function(){$(this).parent().parent().remove()})}function p(){$(this).parent().parent().remove()}function b(){$.get(site+"/myigniter/columns_callback",function(e){$("#table_config_field_box").after(e),$("#columns_field_box").next().remove()}).complete(function(){$("#field-table_name").val()&&x()})}function v(){var e=$(this),a=e.val(),t=e.parent(),i="",n=e.data("name"),l=$("option:selected",this);e.val(""),e.trigger("chosen:updated"),0===t.find('.validation-name:contains("'+a+'")').length&&(i='<div class="box-validation '+l.prop("class")+'">',i+='<label><div class="validation-name">'+a+"</div></label>",$.inArray(a,A)>-1?i+='<input type="text" data-field="'+n+'" data-name="'+a+'" value="" class="small-input validationInputs"/>':M[n].validation.push(a),i+='<a class="delete" data-field="'+n+'" data-name="'+a+'"><i class="fa fa-trash"></i></a>',i+="</div>",t.append(i))}function m(){var e=$(this),a=e.data("name"),t=e.data("field");e.parent(".box-validation").css({"background-color":"red",color:"white"}).fadeOut(S,function(){$(this).remove()}),M[t].validation.forEach(function(e,i){"object"==typeof e?a in e&&M[t].validation.splice(i,1):e===a&&M[t].validation.splice(i,1)})}function y(e){var a=$(this),t=$.inArray(a.val(),["select","select_multiple","checkbox"]),i=a.parents("td"),n=a.parent().next("td").find(".validation"),l=a.parent().next("td").find(".box-validation"),o=a.data("field");t>=0?i.find(".container-table-reff").show():(i.find(".container-table-reff").hide(),i.find(".container-field-reff").hide(),i.find(".container-label-reff").hide(),M[o].selectData={}),n.find("option").each(function(){var e=$(this);e.hasClass(a.val())===!1?e.addClass("hidden"):e.removeClass("hidden"),"required"===e.val()&&e.removeClass("hidden")}),l.each(function(){$rule=$(this),$rule.hasClass(a.val())===!1&&$rule.remove()}),n.trigger("chosen:updated"),M[o].type=a.val()}function g(e){var a=$(this),t=a.parents("td");t.find(".container-field-reff").show(),t.find(".container-label-reff").show(),$.get(site+"/myigniter/getFields/"+a.val(),function(e){t.find(".field-reff").html("<option value></option>"),t.find(".label-reff").html("<option value></option>"),$.each(e,function(e,i){var n="";i.primary_key&&(n="selected",M[a.data("field")].selectData.fieldReff=i.name,M[a.data("field")].selectData.labelReff=i.name,T()),t.find(".field-reff").append("<option "+n+' value="'+i.name+'">'+i.name+"</option>"),t.find(".label-reff").append("<option "+n+' value="'+i.name+'">'+i.name+"</option>")}),t.find(".field-reff").trigger("chosen:updated"),t.find(".label-reff").trigger("chosen:updated")})}function _(e){var a=$(this),t=a.parents("td"),i=t.find(".relation-n-n-primaryKeyAliasToThisTable");i.parent().slideDown(S),t.find(".container-relation-n-n-selectionTable").slideDown(S),$.get(site+"/myigniter/getFields/"+a.val(),function(e){i.html("<option value></option>"),$.each(e,function(e,t){var n="";t.primary_key&&(n="selected",M[a.data("field")].selectMultipleData.relationalTable=a.val(),M[a.data("field")].selectMultipleData.primaryKeyAliasToThisTable=t.name,T()),i.append("<option "+n+' value="'+t.name+'">'+t.name+"</option>")}),i.trigger("chosen:updated")})}function k(e){var a=$(this),t=a.parents("td"),i=t.find(".relation-n-n-primaryKeyAliasToSelectionTable"),n=t.find(".relation-n-n-titleFieldSelectionTable");i.parent().slideDown(S),t.find(".container-relation-n-n-primaryKeyAliasToSelectionTable").slideDown(S),t.find(".container-relation-n-n-titleFieldSelectionTable").slideDown(S),$.get(site+"/myigniter/getFields/"+a.val(),function(e){i.html("<option value></option>"),n.html("<option value></option>"),$.each(e,function(e,t){var l="";t.primary_key&&(l="selected",M[a.data("field")].selectMultipleData.selectionTable=a.val(),M[a.data("field")].selectMultipleData.primaryKeyAliasToSelectionTable=t.name,M[a.data("field")].selectMultipleData.titleFieldSelectionTable=t.name,T()),i.append("<option "+l+' value="'+t.name+'">'+t.name+"</option>"),n.append("<option "+l+' value="'+t.name+'">'+t.name+"</option>")}),i.trigger("chosen:updated"),n.trigger("chosen:updated")})}function x(){var e=$("#field-table_name"),a=$("#advance-fields"),t="",i=$(".overlay"),n=window.location.href;n=n.split("edit/"),"undefined"!=typeof n[1]&&(t="?id="+n[1]),$("#field_table_name_chosen").after('<i class="fa fa-circle-o-notch fa-spin text-primary fa-fw fa-1x table-name-spinner"></i>'),i.removeClass("hidden"),$.get(site+"/myigniter/get_list_fields/"+e.val()+t,function(e){a.html(e).find(".check").iCheck({checkboxClass:"icheckbox_square-blue",radioClass:"iradio_square-blue"}),$("#advance-fields").find(".chosen").chosen(),$(".chosen-container").css("width","100%"),$("#columns_field_box").removeClass("hidden"),s()}).complete(function(){$(".table-name-spinner").remove(),i.addClass("hidden")})}function T(){$("#field-table_config").val(JSON.stringify(M))}function D(){var e=$(this).data("id"),a=$(this).data("builder");e?$.get(site+"/myigniter/export_php/"+e+"/"+a,function(a){$("#PHPCode").html(hljs.highlightAuto(a).value),$("#create-module").data("id",e)}):$.ajax({url:site+"/myigniter/export_php/0/"+a,type:"POST",data:$("#crudForm").serialize()}).done(function(a){$("#PHPCode").html(hljs.highlightAuto(a).value),$("#create-module").data("id",e)}).fail(function(){alertify.alert("Something wrong try again!")})}function C(){var e=$(this).data("id");$.ajax({url:site+"/myigniter/createModule",type:"POST",data:{id:e}}).done(function(e){e.status?alertify.alert("Module created, can be access via path : <pre>/"+e.table+"/crud"+w(e.table)+"</pre> Controller can be found in : <pre>/applcation/modules/"+e.table+"/controllers/"+w(e.table)+".php</pre> <br><a href='"+site+"/"+e.table+"/crud"+w(e.table)+"'>Go to module</a>"):alertify.alert("Module alredy exist!")}).fail(function(){alertify.alert("This features can be use only in development mode!")})}function w(e){var a=e.substr(0,1);return a.toUpperCase()+e.substr(1)}var A=["max_length","min_length","regex","exact_length","less_than","less_than_equal_to","greater_than","greater_than_equal_to","matches","differs","in_list","allowed_extensions","max_width","max_height","max_size"],S=200,M={};if($("#table_config_field_box").length&&b(),"crud_builder"!=segment[2]){var F="table";$('<a href="#exportPHP" style="margin-left: 10px" data-id="0" data-builder="'+F+'" data-toggle="modal" class="btn-php btn btn-success btn-flat"><i class="fa fa-code"></i> Generate Module</a>').insertAfter("#save-and-go-back-button")}new Clipboard(".copy"),$(".check").iCheck({checkboxClass:"icheckbox_square-blue",radioClass:"iradio_square-blue"}),$("#addBreadcrumb").click(h),$(".remove-crumb").click(p),$(".btn-php").click(D),$("#create-module").click(C),$("body").on("change","#field-table_name",x),$("body").on("change",".type",y),$("body").on("change",".table-reff",g),$("body").on("change",".relation-n-n-relationalTable",_),$("body").on("change",".relation-n-n-selectionTable",k),$("body").on("keyup",".relation-n-n-labelName",i),$("body").on("change",".relation-n-n-titleFieldSelectionTable",t),$("body").on("change",".relation-n-n-primaryKeyAliasToThisTable",e),$("body").on("change",".relation-n-n-primaryKeyAliasToSelectionTable",a),$("body").on("change",".validation",{extra:M},v),$("body").on("click",".delete",m),$("body").on("keyup",".validationInputs",r),$("body").on("keyup click change","#table_config",T),$("body").on("ifChecked",".check-config",{val:1},c),$("body").on("ifUnchecked",".check-config",{val:0},c),$("body").on("keyup",".alias",d),$("body").on("change",".table-reff",o),$("body").on("change",".field-reff",n),$("body").on("change",".label-reff",l),$("body").on("click","#form-button-save",T),$("body").on("click","#save-and-go-back-button",T)});